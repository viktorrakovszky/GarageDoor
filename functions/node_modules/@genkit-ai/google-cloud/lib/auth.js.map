{"version":3,"sources":["../src/auth.ts"],"sourcesContent":["/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { logger } from '@genkit-ai/core/logging';\nimport { GoogleAuth } from 'google-auth-library';\nimport { GcpPluginOptions } from './types';\n\n/**\n * Allow customers to pass in cloud credentials from environment variables\n * following: https://github.com/googleapis/google-auth-library-nodejs?tab=readme-ov-file#loading-credentials-from-environment-variables\n */\nexport async function credentialsFromEnvironment(): Promise<GcpPluginOptions> {\n  let authClient: GoogleAuth;\n  let options: GcpPluginOptions = {};\n\n  if (process.env.GCLOUD_SERVICE_ACCOUNT_CREDS) {\n    const serviceAccountCreds = JSON.parse(\n      process.env.GCLOUD_SERVICE_ACCOUNT_CREDS\n    );\n    const authOptions = { credentials: serviceAccountCreds };\n    authClient = new GoogleAuth(authOptions);\n    options.credentials = await authClient.getCredentials();\n  } else {\n    authClient = new GoogleAuth();\n  }\n  try {\n    const projectId = await authClient.getProjectId();\n    if (projectId && projectId.length > 0) {\n      options.projectId = projectId;\n    }\n  } catch (error) {\n    logger.warn(error);\n  }\n  return options;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAeA,qBAAuB;AACvB,iCAA2B;AAO3B,SAAsB,6BAAwD;AAAA;AAC5E,QAAI;AACJ,QAAI,UAA4B,CAAC;AAEjC,QAAI,QAAQ,IAAI,8BAA8B;AAC5C,YAAM,sBAAsB,KAAK;AAAA,QAC/B,QAAQ,IAAI;AAAA,MACd;AACA,YAAM,cAAc,EAAE,aAAa,oBAAoB;AACvD,mBAAa,IAAI,sCAAW,WAAW;AACvC,cAAQ,cAAc,MAAM,WAAW,eAAe;AAAA,IACxD,OAAO;AACL,mBAAa,IAAI,sCAAW;AAAA,IAC9B;AACA,QAAI;AACF,YAAM,YAAY,MAAM,WAAW,aAAa;AAChD,UAAI,aAAa,UAAU,SAAS,GAAG;AACrC,gBAAQ,YAAY;AAAA,MACtB;AAAA,IACF,SAAS,OAAO;AACd,4BAAO,KAAK,KAAK;AAAA,IACnB;AACA,WAAO;AAAA,EACT;AAAA;","names":[]}